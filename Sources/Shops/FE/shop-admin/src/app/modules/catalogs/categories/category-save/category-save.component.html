<form #myForm="ngForm" (ngSubmit)="onSubmit($event, myForm)">
  <div class="modal-header py-4">
    <h4 class="modal-title" id="modal-basic-title">Tạo danh mục</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>

  <div class="modal-body">
    <!-- Code -->
    <div class="fv-row mb-7">
      <label class="required fw-semibold fs-6 mb-2">
        <span>Mã danh mục</span>
        <span class="ms-1" placement="end" ngbTooltip="Chỉ gồm chữ/số, gạch dưới (_), gạch ngang (-)">
          <app-keenicon name="information" class="fs-7"></app-keenicon>
        </span>
      </label>

      <input type="text" class="form-control form-control-sm" name="code" [(ngModel)]="createModel.code" #code="ngModel"
        required pattern="^[A-Za-z0-9_-]+$" />

      <div *ngIf="myForm.submitted && (code.invalid)"
        class="fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback">
        <div *ngIf="code.errors?.['required']">Code is required</div>
        <div *ngIf="code.errors?.['pattern']">Code chỉ được dùng chữ/số/_/-</div>
      </div>
    </div>

    <!-- Name -->
    <div class="fv-row mb-7">
      <label class="required fw-semibold fs-6 mb-2">Tên danh mục</label>

      <input type="text" class="form-control form-control-sm" name="name" [(ngModel)]="createModel.name" #name="ngModel"
        required minlength="4" />

      <div *ngIf="myForm.submitted && (name.invalid)"
        class="fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback">
        <div *ngIf="name.errors?.['required']">Name is required</div>
        <div *ngIf="name.errors?.['minlength']">Name must be at least 4 characters long</div>
      </div>
    </div>

    <!-- Parent -->
    <div class="fv-row mb-7">
      <label class="fw-semibold fs-6 mb-2">
        <span>Danh mục cha</span>
        <span class="ms-1" placement="end" ngbTooltip="Có thể bỏ trống nếu là danh mục gốc">
          <app-keenicon name="information" class="fs-7"></app-keenicon>
        </span>
      </label>

      <p-treeSelect [required]="isRequired && !isParent" #parentId="ngModel" [options]="categorySignalValue"
        [(ngModel)]="selectedNode" placeholder="Chọn loại sản phẩm" name="parentId" [filter]="true" class="w-100"
        (ngModelChange)="handleChange($event)" style="width: 100%;display: grid;">
        <ng-template let-node pTemplate="default">
          <span
            [ngClass]="{'d-flex align-items-center': true, 'text-gray-800': true, 'fw-semibold': node.children?.length > 0}">
            <i *ngIf="node.children?.length > 0" class="fas fa-sitemap me-2 text-primary"></i>
            <i *ngIf="!node.children?.length" class="fas fa-sitemap me-2 text-primary"></i>
            {{ node.label }}
          </span>
        </ng-template>
      </p-treeSelect>
    </div>

    <div class="row">
      <!-- SortOrder -->
      <div class="col-lg-6">
        <div class="fv-row mb-7">
          <label class="fw-semibold fs-6 mb-2">Thứ tự sắp xếp</label>

          <input type="number" class="form-control form-control-sm" name="sortOrder" [(ngModel)]="createModel.sortOrder"
            #sortOrder="ngModel" min="0" />

          <div *ngIf="myForm.submitted && sortOrder.invalid"
            class="fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback">
            <div *ngIf="sortOrder.errors?.['min']">SortOrder phải ≥ 0</div>
          </div>
        </div>
      </div>

      <!-- Level -->
      <div class="col-lg-6">
        <div class="fv-row mb-7">
          <label class="fw-semibold fs-6 mb-2">Cấp (Level)</label>

          <input type="number" class="form-control form-control-sm" name="level" [(ngModel)]="createModel.level"
            #level="ngModel" min="0" />

          <div *ngIf="myForm.submitted && level.invalid"
            class="fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback">
            <div *ngIf="level.errors?.['min']">Level phải ≥ 0</div>
          </div>
        </div>
      </div>
    </div>

    <!-- IsActive -->
    <div class="fv-row mb-2">
      <label class="fw-semibold fs-6 mb-2 d-block">Trạng thái</label>

      <div class="form-check form-check-sm form-switch">
        <input class="form-check-input" type="checkbox" id="isActive" name="isActive"
          [(ngModel)]="createModel.isActive" />
        <label class="form-check-label" for="isActive">
          {{ createModel.isActive ? 'Đang hoạt động' : 'Ngừng hoạt động' }}
        </label>
      </div>
    </div>
  </div>

  <div class="modal-footer flex-center py-4">
    <button type="button" class="btn btn-light me-3 btn-sm" (click)="modal.dismiss('cancel')">
      <i class="fa fa-times"></i> Đóng
    </button>

    <button type="submit" class="btn btn-primary btn-sm" [disabled]="isLoading"
      [attr.data-kt-indicator]="isLoading ? 'on' : 'off'">
      <i class="fa fa-save"></i>
      <span class="indicator-label">Lưu lại</span>
      <span class="indicator-progress">
        Please wait... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
      </span>
    </button>
  </div>
</form>

<swal #noticeSwal [swalOptions]="swalOptions"></swal>